<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤ë§ˆíŠ¸ ë¬¸ì„œ ìŠ¤ìºë„ˆ (êµìœ¡ìš© ë²„ì „)</title>
    <meta name="description" content="AI ê¸°ë°˜ ì›¹ ë¬¸ì„œ ìŠ¤ìºë„ˆ - ê¸°ìš¸ì–´ì§„ ë¬¸ì„œ ì‚¬ì§„ì„ í‰ë©´ ìŠ¤ìº” ì´ë¯¸ì§€ë¡œ ë³€í™˜">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- ğŸ« êµìœ¡ìš© ëª¨ë“ˆ ë¡œë“œ -->
    <!-- í•™ìƒë“¤ê³¼ í•¨ê»˜ ë¶„ì„í•  íŒŒì¼ë“¤ì…ë‹ˆë‹¤! -->
    <script src="js/scanner.js"></script>
    <!-- ğŸ¨ í•„í„° ëª¨ë“ˆ (ê¸°ëŠ¥ë³„ë¡œ ìª¼ê°°ì–´ìš”!) -->
    <script src="js/filters/transform.js"></script>
    <script src="js/filters/texture.js"></script>
    <script src="js/filters/color.js"></script>
    <script src="js/filters/contour.js"></script>
    <script src="js/filters/index.js"></script>
    
    <!-- OpenCV.js -->
    <script>
        // OpenCV.js ë¡œë”© ì™„ë£Œ í”Œë˜ê·¸
        var opencvReady = false;
        function onOpenCvReady() {
            opencvReady = true;
            console.log('OpenCV.js ì™„ì „ ë¡œë”© ì™„ë£Œ!');
        }
    </script>
    <script async src="https://docs.opencv.org/4.x/opencv.js" onload="
        if (typeof cv !== 'undefined') {
            if (cv.Mat) {
                onOpenCvReady();
            } else {
                cv['onRuntimeInitialized'] = onOpenCvReady;
            }
        }
    "></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff', 100: '#e0f2fe', 200: '#bae6fd', 300: '#7dd3fc', 
                            400: '#38bdf8', 500: '#0ea5e9', 600: '#0284c7', 700: '#0369a1',
                            800: '#075985', 900: '#0c4a6e',
                        },
                        accent: {
                            400: '#a78bfa', 500: '#8b5cf6', 600: '#7c3aed',
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * { font-family: 'Inter', sans-serif; }
        body { background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%); min-height: 100vh; }
        .glass-card { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .drop-zone { background: linear-gradient(135deg, rgba(14, 165, 233, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%); border: 2px dashed rgba(14, 165, 233, 0.5); transition: all 0.3s ease; }
        .drop-zone:hover, .drop-zone.dragover { background: linear-gradient(135deg, rgba(14, 165, 233, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%); border-color: rgba(14, 165, 233, 0.8); transform: scale(1.02); }
        .btn-primary { background: linear-gradient(135deg, #0ea5e9 0%, #8b5cf6 100%); transition: all 0.3s ease; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 40px rgba(14, 165, 233, 0.3); }
        .btn-secondary { background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); transition: all 0.3s ease; }
        .btn-secondary:hover { background: rgba(255, 255, 255, 0.2); }
        .btn-secondary.active { background: linear-gradient(135deg, #0ea5e9 0%, #8b5cf6 100%); border-color: transparent; }
        .slider-container input[type="range"] { -webkit-appearance: none; width: 100%; height: 6px; background: linear-gradient(90deg, #0ea5e9 0%, #8b5cf6 100%); border-radius: 3px; outline: none; }
        .slider-container input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; background: white; border-radius: 50%; cursor: pointer; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3); transition: transform 0.2s ease; }
        .slider-container input[type="range"]::-webkit-slider-thumb:hover { transform: scale(1.2); }
        .canvas-container { position: relative; overflow: hidden; border-radius: 12px; background: rgba(0, 0, 0, 0.3); }
        .canvas-container canvas { max-width: 100%; max-height: 400px; object-fit: contain; }
        .loading-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(15, 23, 42, 0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; }
        .spinner { width: 60px; height: 60px; border: 4px solid rgba(14, 165, 233, 0.2); border-top-color: #0ea5e9; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.5s ease forwards; }
        .glow { box-shadow: 0 0 30px rgba(14, 165, 233, 0.3), 0 0 60px rgba(139, 92, 246, 0.2); }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;
        
        // ìƒ‰ìƒ ëª¨ë“œ ìƒìˆ˜
        const COLOR_MODES = {
            ORIGINAL: 'original',
            GRAYSCALE: 'grayscale',
            SCAN: 'scan'
        };
        
        // ë©”ì¸ ì•± ì»´í¬ë„ŒíŠ¸
        function App() {
            const [cvReady, setCvReady] = useState(false);
            const [loading, setLoading] = useState(true);
            const [processing, setProcessing] = useState(false);
            const [originalImage, setOriginalImage] = useState(null);
            const [scannedImage, setScannedImage] = useState(null);
            const [originalImageSrc, setOriginalImageSrc] = useState(null); // ì›ë³¸ ì´ë¯¸ì§€ ì†ŒìŠ¤ ì €ì¥
            
            // í•„í„° ìƒíƒœ ë³€ìˆ˜ë“¤
            const [colorMode, setColorMode] = useState(COLOR_MODES.ORIGINAL);
            const [intensity, setIntensity] = useState(127);
            const [edgeDetection, setEdgeDetection] = useState(false);
            const [adaptiveThreshold, setAdaptiveThreshold] = useState(false);
            const [adaptiveBlockSize, setAdaptiveBlockSize] = useState(11);
            const [blurAmount, setBlurAmount] = useState(0);
            const [spotColorMode, setSpotColorMode] = useState('none');
            const [contrastValue, setContrastValue] = useState(100);
            const [sharpenAmount, setSharpenAmount] = useState(0);
            const [contourOverlay, setContourOverlay] = useState(false);
            const [rotationAngle, setRotationAngle] = useState(0);
            const [flipHorizontal, setFlipHorizontal] = useState(false);
            const [flipVertical, setFlipVertical] = useState(false);
            
            // ì¶œë ¥ ì‚¬ì´ì¦ˆ ìƒíƒœ
            const [outputSize, setOutputSize] = useState('original');
            
            const [dragOver, setDragOver] = useState(false);
            const [detectionSuccess, setDetectionSuccess] = useState(false);
            
            const originalCanvasRef = useRef(null);
            const resultCanvasRef = useRef(null);
            const fileInputRef = useRef(null);
            
            // OpenCV.js ë¡œë”© í™•ì¸
            useEffect(() => {
                const checkOpenCV = () => {
                    if (typeof cv !== 'undefined' && cv.Mat && typeof cv.imread === 'function' && window.ScannerUtils) {
                        setCvReady(true);
                        setLoading(false);
                        console.log('OpenCV.js ë° êµìœ¡ìš© ëª¨ë“ˆ ì¤€ë¹„ ì™„ë£Œ!');
                    } else if (window.opencvReady && window.ScannerUtils) {
                        setCvReady(true);
                        setLoading(false);
                         console.log('OpenCV.js ë° êµìœ¡ìš© ëª¨ë“ˆ ì¤€ë¹„ ì™„ë£Œ! (flag)');
                    } else {
                        setTimeout(checkOpenCV, 200);
                    }
                };
                setTimeout(checkOpenCV, 1000);
            }, []);
            
            // ì´ë¯¸ì§€ ì²˜ë¦¬ í•¨ìˆ˜ (ScannerUtils ì‚¬ìš©)
            const processImage = useCallback((imageSrc) => {
                if (!cvReady) {
                    alert('OpenCV.jsê°€ ë¡œë”© ì¤‘ì…ë‹ˆë‹¤.');
                    return;
                }
                setProcessing(true);
                
                const img = new Image();
                img.crossOrigin = 'anonymous';
                img.onload = () => {
                    try {
                        // ğŸ“± ëª¨ë°”ì¼ ëŒ€ì‘: ì´ë¯¸ì§€ ì „ì²˜ë¦¬
                        // 1. í° ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì¦ˆ (ë©”ëª¨ë¦¬ ì ˆì•½ ë° ì²˜ë¦¬ ì†ë„ í–¥ìƒ)
                        const maxSize = 1920;
                        let targetWidth = img.width;
                        let targetHeight = img.height;
                        
                        if (img.width > maxSize || img.height > maxSize) {
                            const scale = Math.min(maxSize / img.width, maxSize / img.height);
                            targetWidth = Math.round(img.width * scale);
                            targetHeight = Math.round(img.height * scale);
                            console.log(`ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì¦ˆ: ${img.width}x${img.height} -> ${targetWidth}x${targetHeight}`);
                        }
                        
                        const tempCanvas = document.createElement('canvas');
                        tempCanvas.width = targetWidth;
                        tempCanvas.height = targetHeight;
                        const tempCtx = tempCanvas.getContext('2d');
                        // EXIF ë°©í–¥ì€ ìµœì‹  ë¸Œë¼ìš°ì €ì—ì„œ ìë™ ì²˜ë¦¬ë¨
                        tempCtx.drawImage(img, 0, 0, targetWidth, targetHeight);
                        
                        const src = cv.imread(tempCanvas);
                        
                        // [ëª¨ë“ˆ ì‚¬ìš©] 1. ë¬¸ì„œ ì°¾ê¸°
                        console.log('ë¬¸ì„œ ê°ì§€ ì‹œì‘...');
                        const docInfo = ScannerUtils.findDocument(src);
                        
                        let displayOriginal = src.clone(); // í™”ë©´ í‘œì‹œìš© ì›ë³¸ (ë¹¨ê°„ í…Œë‘ë¦¬ ì—†ì´ ê¹¨ë—í•˜ê²Œ)
                        let result;
                        
                        if (docInfo) {
                            console.log('ë¬¸ì„œ ê°ì§€ ì„±ê³µ!', docInfo.area);
                            
                            // [ëª¨ë“ˆ ì‚¬ìš©] 2. ë¬¸ì„œ í´ê¸°
                            result = ScannerUtils.scanDocument(src, docInfo.contour);
                            setDetectionSuccess(true);
                            docInfo.contour.delete();
                        } else {
                            console.log('ë¬¸ì„œ ê°ì§€ ì‹¤íŒ¨, ì›ë³¸ ì‚¬ìš©');
                            result = src.clone();
                            setDetectionSuccess(false);
                        }
                        
                        // React State ì—…ë°ì´íŠ¸ (ë©”ëª¨ë¦¬ ê´€ë¦¬ í¬í•¨)
                        setOriginalImage(prev => {
                            if (prev) prev.delete(); // ì´ì „ ì´ë¯¸ì§€ ì‚­ì œ
                            return displayOriginal;
                        });
                        
                        setScannedImage(prev => {
                            if (prev) prev.delete(); // ì´ì „ ê²°ê³¼ ì‚­ì œ
                            return result;
                        });
                        
                        src.delete(); // ì„ì‹œ ë¡œë“œí•œ ì›ë³¸ ë©”ëª¨ë¦¬ í•´ì œ
                        
                    } catch (error) {
                        console.error('ì´ë¯¸ì§€ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                        alert('ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
                    } finally {
                        setProcessing(false);
                    }
                };
                img.src = imageSrc;
            }, [cvReady]);
            
            // í•„í„° ì ìš© (FilterUtils ì‚¬ìš©)
            useEffect(() => {
                if (!scannedImage || !cvReady || !resultCanvasRef.current) return;
                
                try {
                    // [ëª¨ë“ˆ ì‚¬ìš©] í•„í„° ì˜µì…˜ ê°ì²´ ë§Œë“¤ê¸°
                    const options = {
                        rotation: rotationAngle,
                        flipH: flipHorizontal,
                        flipV: flipVertical,
                        blur: blurAmount,
                        sharpen: sharpenAmount,
                        mode: colorMode,
                        intensity: intensity,
                        adaptive: adaptiveThreshold,
                        blockSize: adaptiveBlockSize,
                        edge: edgeDetection,
                        contour: contourOverlay,
                        spotColor: spotColorMode,
                        contrast: contrastValue
                    };
                    
                    // ëª¨ë“  í•„í„° í•œ ë²ˆì— ì ìš©
                    const filtered = FilterUtils.applyAll(scannedImage, options);
                    
                    // ì¶œë ¥ ì‚¬ì´ì¦ˆ ì •ì˜ (ê°€ë¡œ x ì„¸ë¡œ í”½ì…€, 300DPI ê¸°ì¤€)
                    const OUTPUT_SIZES = {
                        original: { label: '1:1 (ì›ë³¸)', width: null, height: null },
                        a4_portrait: { label: 'A4 ì„¸ë¡œ', width: 2480, height: 3508 },
                        a4_landscape: { label: 'A4 ê°€ë¡œ', width: 3508, height: 2480 },
                        b3_portrait: { label: 'B3 ì„¸ë¡œ', width: 4169, height: 5906 },
                        b3_landscape: { label: 'B3 ê°€ë¡œ', width: 5906, height: 4169 },
                        a3_portrait: { label: 'A3 ì„¸ë¡œ', width: 3508, height: 4961 },
                        a3_landscape: { label: 'A3 ê°€ë¡œ', width: 4961, height: 3508 },
                        letter_portrait: { label: 'Letter ì„¸ë¡œ', width: 2550, height: 3300 },
                        letter_landscape: { label: 'Letter ê°€ë¡œ', width: 3300, height: 2550 },
                    };
                    
                    const sizeConfig = OUTPUT_SIZES[outputSize];
                    
                    // ìš©ì§€ ì‚¬ì´ì¦ˆê°€ ì„ íƒëœ ê²½ìš° ë¦¬ì‚¬ì´ì¦ˆ ì ìš©
                    if (sizeConfig && sizeConfig.width && sizeConfig.height) {
                        const resized = new cv.Mat();
                        cv.resize(filtered, resized, new cv.Size(sizeConfig.width, sizeConfig.height), 0, 0, cv.INTER_LINEAR);
                        cv.imshow(resultCanvasRef.current, resized);
                        resized.delete();
                    } else {
                        cv.imshow(resultCanvasRef.current, filtered);
                    }
                    
                    filtered.delete(); // ë©”ëª¨ë¦¬ í•´ì œ
                    
                } catch (error) {
                    console.error('í•„í„° ì ìš© ì˜¤ë¥˜:', error);
                }
            }, [colorMode, intensity, scannedImage, edgeDetection, adaptiveThreshold, adaptiveBlockSize, 
                blurAmount, spotColorMode, contrastValue, sharpenAmount, contourOverlay, 
                rotationAngle, flipHorizontal, flipVertical, cvReady, outputSize]);
            
            // ì›ë³¸ ì´ë¯¸ì§€ í‘œì‹œ
            useEffect(() => {
                if (originalImage && originalCanvasRef.current) {
                    cv.imshow(originalCanvasRef.current, originalImage);
                }
            }, [originalImage]);
            
            // íŒŒì¼ ì²˜ë¦¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
            const handleFile = useCallback((file) => {
                if (!file || !file.type.startsWith('image/')) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    const imageSrc = e.target.result;
                    setOriginalImageSrc(imageSrc); // ì›ë³¸ ì´ë¯¸ì§€ ì†ŒìŠ¤ ì €ì¥
                    processImage(imageSrc);
                };
                reader.readAsDataURL(file);
            }, [processImage]);
            
            const handleDragOver = (e) => { e.preventDefault(); setDragOver(true); };
            const handleDragLeave = (e) => { e.preventDefault(); setDragOver(false); };
            const handleDrop = (e) => { e.preventDefault(); setDragOver(false); handleFile(e.dataTransfer.files[0]); };
            const handleFileSelect = (e) => handleFile(e.target.files[0]);
            
            // ì¶œë ¥ ì‚¬ì´ì¦ˆ ì •ì˜ (ê°€ë¡œ x ì„¸ë¡œ í”½ì…€, 300DPI ê¸°ì¤€)
            const OUTPUT_SIZES = {
                original: { label: '1:1 (ì›ë³¸)', width: null, height: null },
                a4_portrait: { label: 'A4 ì„¸ë¡œ', width: 2480, height: 3508 },
                a4_landscape: { label: 'A4 ê°€ë¡œ', width: 3508, height: 2480 },
                b3_portrait: { label: 'B3 ì„¸ë¡œ', width: 4169, height: 5906 },
                b3_landscape: { label: 'B3 ê°€ë¡œ', width: 5906, height: 4169 },
                a3_portrait: { label: 'A3 ì„¸ë¡œ', width: 3508, height: 4961 },
                a3_landscape: { label: 'A3 ê°€ë¡œ', width: 4961, height: 3508 },
                letter_portrait: { label: 'Letter ì„¸ë¡œ', width: 2550, height: 3300 },
                letter_landscape: { label: 'Letter ê°€ë¡œ', width: 3300, height: 2550 },
            };
            
            const downloadImage = () => {
                const canvas = resultCanvasRef.current;
                if (!canvas) return;
                
                const sizeConfig = OUTPUT_SIZES[outputSize];
                
                // ì›ë³¸ í¬ê¸°ë¡œ ë‹¤ìš´ë¡œë“œ
                if (!sizeConfig.width || !sizeConfig.height) {
                    const link = document.createElement('a');
                    link.download = `scan_${Date.now()}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    return;
                }
                
                // ì§€ì •ëœ í¬ê¸°ë¡œ ë¦¬ì‚¬ì´ì¦ˆí•˜ì—¬ ë‹¤ìš´ë¡œë“œ (ê½‰ ì±„ì›Œì„œ ëŠ˜ë¦¬ê¸°)
                const outputCanvas = document.createElement('canvas');
                outputCanvas.width = sizeConfig.width;
                outputCanvas.height = sizeConfig.height;
                const ctx = outputCanvas.getContext('2d');
                
                // ì´ë¯¸ì§€ë¥¼ ìš©ì§€ ì‚¬ì´ì¦ˆì— ê½‰ ì±„ì›Œì„œ ëŠ˜ë¦¬ê¸° (ë¹„ìœ¨ ë¬´ì‹œ)
                ctx.drawImage(canvas, 0, 0, outputCanvas.width, outputCanvas.height);
                
                const link = document.createElement('a');
                link.download = `scan_${sizeConfig.label.replace(/ /g, '_')}_${Date.now()}.png`;
                link.href = outputCanvas.toDataURL('image/png');
                link.click();
            };
            
            // í•„í„° ì´ˆê¸°í™” + perspective ë‹¤ì‹œ ìˆ˜í–‰ (ì›ë³¸ ì†ŒìŠ¤ë¡œ ì¬ì²˜ë¦¬)
            const resetFilters = () => {
                // í•„í„° ìƒíƒœ ì´ˆê¸°í™”
                setColorMode(COLOR_MODES.ORIGINAL);
                setIntensity(127);
                setEdgeDetection(false);
                setAdaptiveThreshold(false);
                setAdaptiveBlockSize(11);
                setBlurAmount(0);
                setSpotColorMode('none');
                setContrastValue(100);
                setSharpenAmount(0);
                setContourOverlay(false);
                setRotationAngle(0);
                setFlipHorizontal(false);
                setFlipVertical(false);
                setOutputSize('original');
                
                // í˜„ì¬ scannedImage ì‚­ì œí•˜ê³  ì›ë³¸ ì†ŒìŠ¤ë¡œ ë‹¤ì‹œ perspective transform ìˆ˜í–‰
                if (originalImageSrc) {
                    if (scannedImage) {
                        scannedImage.delete();
                        setScannedImage(null);
                    }
                    if (originalImage) {
                        originalImage.delete();
                        setOriginalImage(null);
                    }
                    processImage(originalImageSrc);
                }
            };
            
            // ì™„ì „ ì´ˆê¸°í™” (ì´ë¯¸ì§€ë„ ì‚­ì œí•˜ê³  í™ˆìœ¼ë¡œ)
            const resetApp = () => {
                if (originalImage) originalImage.delete();
                if (scannedImage) scannedImage.delete();
                setOriginalImage(null);
                setScannedImage(null);
                resetFilters();
                setDetectionSuccess(false);
                
                // ìº”ë²„ìŠ¤ í´ë¦¬ì–´
                const clearCanvas = (ref) => {
                    if (ref.current) {
                        const ctx = ref.current.getContext('2d');
                        ctx.clearRect(0, 0, ref.current.width, ref.current.height);
                    }
                };
                clearCanvas(originalCanvasRef);
                clearCanvas(resultCanvasRef);
            };
            
            // UI ë Œë”ë§
            if (loading) {
                return (
                    <div className="loading-overlay">
                        <div className="spinner mb-6"></div>
                        <h2 className="text-white text-xl font-medium">ê°•ì˜ ì‹¤ìŠµ ì¤€ë¹„ ì¤‘...</h2>
                        <p className="text-gray-400 mt-2">OpenCV.jsì™€ ëª¨ë“ˆì„ ë¶ˆëŸ¬ì˜¤ê³  ìˆì–´ìš”</p>
                    </div>
                );
            }
            
            return (
                <div className="min-h-screen py-8 px-4">
                    <div className="max-w-6xl mx-auto">
                        <header className="text-center mb-8 animate-fade-in">
                            <h1 className="text-4xl md:text-5xl font-bold bg-gradient-to-r from-primary-400 to-accent-400 bg-clip-text text-transparent mb-3">
                                ìŠ¤ë§ˆíŠ¸ ë¬¸ì„œ ìŠ¤ìºë„ˆ
                            </h1>
                            <p className="text-gray-400 text-lg">
                                ìˆ˜ì—… ì‹œê°„ì— ë°°ìš´ ê¸°ìˆ ë¡œ ë¬¸ì„œë¥¼ ìŠ¤ìº”í•˜ê³  ê¾¸ë©°ë³´ì„¸ìš”! ğŸ“
                            </p>
                        </header>
                        
                        {!scannedImage && (
                            <div 
                                className={`drop-zone rounded-2xl p-12 text-center cursor-pointer mb-8 animate-fade-in ${dragOver ? 'dragover' : ''}`}
                                onDragOver={handleDragOver}
                                onDragLeave={handleDragLeave}
                                onDrop={handleDrop}
                                onClick={() => fileInputRef.current?.click()}
                            >
                                <input ref={fileInputRef} type="file" accept="image/*" onChange={handleFileSelect} className="hidden" />
                                <div className="mb-4">
                                    <svg className="w-16 h-16 mx-auto text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                    </svg>
                                </div>
                                <h3 className="text-xl font-medium text-white mb-2">ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</h3>
                                <p className="text-gray-400">JPG, PNG, WEBP ì§€ì›</p>
                            </div>
                        )}
                        
                        {processing && (
                            <div className="loading-overlay">
                                <div className="spinner mb-6"></div>
                                <h2 className="text-white text-xl font-medium">ë¶„ì„ ì¤‘...</h2>
                                <p className="text-gray-400 mt-2">ë¬¸ì„œì˜ í…Œë‘ë¦¬ë¥¼ ì°¾ê³  ìˆì–´ìš”!</p>
                            </div>
                        )}
                        
                        {scannedImage && (
                            <div className="animate-fade-in">
                                <div className={`mb-6 p-4 rounded-xl ${detectionSuccess ? 'bg-green-500/20 border border-green-500/30' : 'bg-yellow-500/20 border border-yellow-500/30'}`}>
                                    <p className={`text-center ${detectionSuccess ? 'text-green-300' : 'text-yellow-300'}`}>
                                        {detectionSuccess 
                                            ? 'âœ“ ë¬¸ì„œë¥¼ ì°¾ì•„ì„œ ë°˜ë“¯í•˜ê²Œ íˆì–´ìš”! (Perspective Transform)'
                                            : 'âš  ë¬¸ì„œë¥¼ ì°¾ì§€ ëª»í–ˆì–´ìš”. ì›ë³¸ ì´ë¯¸ì§€ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.'}
                                    </p>
                                </div>
                                
                                <div className="grid md:grid-cols-2 gap-6 mb-8">
                                    <div className="glass-card rounded-2xl p-4">
                                        <h3 className="text-white font-medium mb-3 flex items-center gap-2">ì›ë³¸ ì´ë¯¸ì§€</h3>
                                        <div className="canvas-container flex items-center justify-center min-h-[300px]">
                                            <canvas ref={originalCanvasRef} className="rounded-lg"></canvas>
                                        </div>
                                    </div>
                                    <div className="glass-card rounded-2xl p-4 glow">
                                        <h3 className="text-white font-medium mb-3 flex items-center gap-2">ê²°ê³¼ ì´ë¯¸ì§€</h3>
                                        <div className="canvas-container flex items-center justify-center min-h-[300px]">
                                            <canvas ref={resultCanvasRef} className="rounded-lg"></canvas>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="grid md:grid-cols-2 gap-6 mb-6">
                                    <div className="glass-card rounded-2xl p-6">
                                        <h3 className="text-white font-medium mb-4">í•„í„° ì„¤ì •</h3>
                                        
                                        <div className="flex flex-wrap gap-3 mb-6">
                                            <button onClick={() => setColorMode(COLOR_MODES.ORIGINAL)} className={`btn-secondary px-5 py-2.5 rounded-xl text-white font-medium ${colorMode === COLOR_MODES.ORIGINAL ? 'active' : ''}`}>ì›ë³¸</button>
                                            <button onClick={() => setColorMode(COLOR_MODES.GRAYSCALE)} className={`btn-secondary px-5 py-2.5 rounded-xl text-white font-medium ${colorMode === COLOR_MODES.GRAYSCALE ? 'active' : ''}`}>í‘ë°± (Grayscale)</button>
                                            <button onClick={() => setColorMode(COLOR_MODES.SCAN)} className={`btn-secondary px-5 py-2.5 rounded-xl text-white font-medium ${colorMode === COLOR_MODES.SCAN ? 'active' : ''}`}>ìŠ¤ìº” ëª¨ë“œ (Binary)</button>
                                        </div>
                                        
                                        {colorMode === COLOR_MODES.SCAN && (
                                            <div className="slider-container">
                                                <div className="flex justify-between items-center mb-2">
                                                    <label className="text-gray-300">ìŠ¤ìº” ê°•ë„ (Threshold)</label>
                                                    <span className="text-primary-400 font-mono">{intensity}</span>
                                                </div>
                                                <input type="range" min="50" max="200" value={intensity} onChange={(e) => setIntensity(parseInt(e.target.value))} className="w-full" />
                                            </div>
                                        )}
                                    </div>
                                    
                                    <div className="glass-card rounded-2xl p-6">
                                        <h3 className="text-white font-medium mb-4">ì¶œë ¥ ê²°ê³¼</h3>
                                        
                                        <div className="mb-4">
                                            <label className="text-gray-300 text-sm block mb-2">ìš©ì§€ ì‚¬ì´ì¦ˆ (Paper Size)</label>
                                            <select 
                                                value={outputSize} 
                                                onChange={(e) => setOutputSize(e.target.value)}
                                                className="w-full bg-slate-700/50 border border-slate-600 text-white rounded-lg px-4 py-2.5 focus:outline-none focus:border-primary-400 transition-colors"
                                            >
                                                <option value="original">1:1 (ì›ë³¸ í¬ê¸°)</option>
                                                <option value="a4_portrait">A4 ì„¸ë¡œ (210Ã—297mm)</option>
                                                <option value="a4_landscape">A4 ê°€ë¡œ (297Ã—210mm)</option>
                                                <option value="a3_portrait">A3 ì„¸ë¡œ (297Ã—420mm)</option>
                                                <option value="a3_landscape">A3 ê°€ë¡œ (420Ã—297mm)</option>
                                                <option value="b3_portrait">B3 ì„¸ë¡œ (353Ã—500mm)</option>
                                                <option value="b3_landscape">B3 ê°€ë¡œ (500Ã—353mm)</option>
                                                <option value="letter_portrait">Letter ì„¸ë¡œ (8.5Ã—11in)</option>
                                                <option value="letter_landscape">Letter ê°€ë¡œ (11Ã—8.5in)</option>
                                            </select>
                                        </div>
                                        
                                        <p className="text-gray-400 text-xs">
                                            ğŸ’¡ ì„ íƒí•œ ì‚¬ì´ì¦ˆë¡œ ì´ë¯¸ì§€ê°€ ë¦¬ì‚¬ì´ì¦ˆë˜ì–´ ë‹¤ìš´ë¡œë“œë©ë‹ˆë‹¤. (300DPI ê¸°ì¤€)
                                        </p>
                                    </div>
                                </div>
                                
                                <div className="glass-card rounded-2xl p-6 mb-6">
                                    <h3 className="text-white font-medium mb-4 flex items-center gap-2">ì´ë¯¸ì§€ê¾¸ë¯¸ê¸°</h3>
                                    
                                    <div className="flex flex-wrap gap-2 mb-6">
                                        <button onClick={() => setEdgeDetection(!edgeDetection)} className={`btn-secondary px-4 py-2 rounded-lg text-sm flex-1 ${edgeDetection ? 'active' : ''}`}>{edgeDetection ? 'âœ“ ' : ''}ì—£ì§€ ê°ì§€ (Canny)</button>
                                        <button onClick={() => setAdaptiveThreshold(!adaptiveThreshold)} className={`btn-secondary px-4 py-2 rounded-lg text-sm flex-1 ${adaptiveThreshold ? 'active' : ''}`}>{adaptiveThreshold ? 'âœ“ ' : ''}ì ì‘í˜• ì´ì§„í™” (Adaptive)</button>
                                        <button onClick={() => setContourOverlay(!contourOverlay)} className={`btn-secondary px-4 py-2 rounded-lg text-sm flex-1 ${contourOverlay ? 'active' : ''}`}>{contourOverlay ? 'âœ“ ' : ''}ìœ¤ê³½ì„  ì˜¤ë²„ë ˆì´ (Contours)</button>
                                    </div>
                                    
                                    <div className="space-y-4 mb-6">
                                        <div className="slider-container">
                                            <div className="flex justify-between items-center mb-2"><label className="text-gray-300 text-sm">ë¸”ëŸ¬ (Gaussian Blur)</label><span className="text-primary-400 font-mono text-sm">{blurAmount}</span></div>
                                            <input type="range" min="0" max="20" value={blurAmount} onChange={(e) => setBlurAmount(parseInt(e.target.value))} className="w-full" />
                                        </div>
                                        <div className="slider-container">
                                            <div className="flex justify-between items-center mb-2"><label className="text-gray-300 text-sm">ìƒ¤í”„ë‹ (Sharpen)</label><span className="text-primary-400 font-mono text-sm">{sharpenAmount}</span></div>
                                            <input type="range" min="0" max="100" value={sharpenAmount} onChange={(e) => setSharpenAmount(parseInt(e.target.value))} className="w-full" />
                                        </div>
                                        <div className="slider-container">
                                            <div className="flex justify-between items-center mb-2"><label className="text-gray-300 text-sm">ëŒ€ë¹„ ì¡°ì ˆ (Contrast)</label><span className="text-primary-400 font-mono text-sm">{contrastValue}%</span></div>
                                            <input type="range" min="50" max="200" value={contrastValue} onChange={(e) => setContrastValue(parseInt(e.target.value))} className="w-full" />
                                        </div>
                                        
                                        <div className="mb-4">
                                            <label className="text-gray-300 text-sm block mb-2">ìŠ¤íŒŸ ì»¬ëŸ¬ (Color Highlight)</label>
                                            <div className="grid grid-cols-4 gap-2">
                                                <button onClick={() => setSpotColorMode('none')} className={`py-2 rounded-lg text-sm border font-medium ${spotColorMode === 'none' ? 'bg-gray-600 border-gray-500 text-white' : 'bg-transparent border-gray-600 text-gray-400 hover:bg-gray-700'}`}>ì—†ìŒ</button>
                                                <button onClick={() => setSpotColorMode('red')} className={`py-2 rounded-lg text-sm border font-medium flex items-center justify-center gap-1 ${spotColorMode === 'red' ? 'bg-red-500/30 border-red-500 text-red-300' : 'bg-transparent border-gray-600 text-gray-400 hover:bg-gray-700'}`}><div className="w-2 h-2 rounded-full bg-red-500"></div>ë¹¨ê°•</button>
                                                <button onClick={() => setSpotColorMode('green')} className={`py-2 rounded-lg text-sm border font-medium flex items-center justify-center gap-1 ${spotColorMode === 'green' ? 'bg-green-500/30 border-green-500 text-green-300' : 'bg-transparent border-gray-600 text-gray-400 hover:bg-gray-700'}`}><div className="w-2 h-2 rounded-full bg-green-500"></div>ì´ˆë¡</button>
                                                <button onClick={() => setSpotColorMode('blue')} className={`py-2 rounded-lg text-sm border font-medium flex items-center justify-center gap-1 ${spotColorMode === 'blue' ? 'bg-blue-500/30 border-blue-500 text-blue-300' : 'bg-transparent border-gray-600 text-gray-400 hover:bg-gray-700'}`}><div className="w-2 h-2 rounded-full bg-blue-500"></div>íŒŒë‘</button>
                                            </div>
                                        </div>
                                        
                                        {adaptiveThreshold && (
                                            <div className="slider-container">
                                                <div className="flex justify-between items-center mb-2"><label className="text-gray-300 text-sm">ë¸”ë¡ í¬ê¸° (Block Size)</label><span className="text-primary-400 font-mono text-sm">{adaptiveBlockSize}</span></div>
                                                <input type="range" min="3" max="51" step="2" value={adaptiveBlockSize} onChange={(e) => setAdaptiveBlockSize(parseInt(e.target.value))} className="w-full" />
                                            </div>
                                        )}
                                    </div>
                                    
                                    <div className="mb-4">
                                        <label className="text-gray-300 text-sm block mb-2">íšŒì „ ë° ëŒ€ì¹­ (Rotate & Flip)</label>
                                        <div className="flex gap-2 mb-2">
                                            <button onClick={() => setRotationAngle((prev) => (prev - 90 + 360) % 360)} className="btn-secondary px-4 py-2 rounded-lg text-sm flex-1">â†º 90Â° ì™¼ìª½</button>
                                            <button onClick={() => setRotationAngle(0)} className={`btn-secondary px-4 py-2 rounded-lg text-sm ${rotationAngle === 0 ? 'active' : ''}`}>{rotationAngle}Â°</button>
                                            <button onClick={() => setRotationAngle((prev) => (prev + 90) % 360)} className="btn-secondary px-4 py-2 rounded-lg text-sm flex-1">90Â° ì˜¤ë¥¸ìª½ â†»</button>
                                        </div>
                                        <div className="flex gap-2">
                                            <button onClick={() => setFlipHorizontal(!flipHorizontal)} className={`btn-secondary px-4 py-2 rounded-lg text-sm flex-1 ${flipHorizontal ? 'active' : ''}`}>{flipHorizontal ? 'âœ“ ' : ''}â†” ì¢Œìš° ëŒ€ì¹­</button>
                                            <button onClick={() => setFlipVertical(!flipVertical)} className={`btn-secondary px-4 py-2 rounded-lg text-sm flex-1 ${flipVertical ? 'active' : ''}`}>{flipVertical ? 'âœ“ ' : ''}â†• ìƒí•˜ ëŒ€ì¹­</button>
                                        </div>
                                    </div>
                                    
                                    <button onClick={resetFilters} className="w-full btn-secondary px-4 py-2 rounded-lg text-sm border-2 border-yellow-500/50 hover:bg-yellow-500/20">ğŸ”„ ëª¨ë“  íš¨ê³¼ ì´ˆê¸°í™”</button>
                                </div>
                                
                                <div className="flex flex-wrap gap-4 justify-center">
                                    <button onClick={downloadImage} className="btn-primary px-8 py-3 rounded-xl text-white font-medium flex items-center gap-2">
                                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
                                        ê²°ê³¼ ë‹¤ìš´ë¡œë“œ
                                    </button>
                                    <button onClick={() => setScannedImage(null)} className="btn-secondary px-8 py-3 rounded-xl text-white font-medium flex items-center gap-2">
                                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>
                                        ìƒˆ ì´ë¯¸ì§€ ì—…ë¡œë“œ
                                    </button>
                                </div>
                            </div>
                        )}
                        
                        <footer className="mt-12 text-center text-gray-500 text-sm">
                            <p>OpenCV.js ê¸°ë°˜ ë¬¸ì„œ ìŠ¤ìºë„ˆ â€¢ êµìœ¡ìš© ë¦¬íŒ©í† ë§ ë²„ì „</p>
                        </footer>
                    </div>
                </div>
            );
        }
        
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
